<!DOCTYPE html>
<html lang="pl">
<head>
	<link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <title>stsrv</title>
</head>
<body>
	
	<div class="container">
	<nav>
	  <a class="selected" href="index.html">Strona Główna</a> |
	  <a href="znajomi.html">Znajomi</a>
	</nav>
	<br>
    <p id="status"></p>
		<br/>

    <h1>Logowanie / Rejestracja</h1>

    <input type="text" id="log" placeholder="Login">
    <input type="password" id="pass" placeholder="Haslo">
    <button onclick="zaloguj()">Zaloguj</button>
    <button onclick="zarejestruj()">Zarejestruj</button>

    <pre id="result"></pre>
	<div id="admin_panel" class="hidden">
		<input type="text" id="admin_url" placeholder="URL">
		<input type="text" id="admin_login" placeholder="Login">
		<button onclick="admin_add()">Dodaj</button>
		<button onclick="admin_remove()">Usuń</button>
	</div>
	<br>
	<div id="gallery"></div>
	</div>
	
    <script>
        window.onload = function() {
		document.getElementById("admin_panel").style.display = "none";
        document.getElementById("status").innerText = "Łączenie z serwerem...";
        fetch("https://cpp-b.onrender.com/")
        .then(res => res.text())
        .then(text => document.getElementById("status").innerText = "Status serwera: " + text)
        .catch(err => {console.error(err);
                        document.getElementById("status").innerText = "Błąd połączenia z serwerem";
                      });
		const login = localStorage.getItem("login");
		const pass = localStorage.getItem("password");
		if(login && pass){

			document.getElementById("log").value=login;
			document.getElementById("pass").value=pass;
			zaloguj();
		
		}
			
		
            
        };

        function send() {
            const a = document.getElementById("a").value;
            const b = document.getElementById("b").value;

            fetch("https://cpp-b.onrender.com/calculate", {
                method: "POST",
                headers: {
                      "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    a: a,
                    b: b
                })
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById("result").innerText =
                    "Suma: " + data.suma + "\nIloczyn: " + data.iloczyn;
            })
        };


	function zaloguj() {
			document.getElementById("admin_panel").style.display = "none";
            const log = document.getElementById("log").value;
            const pass = document.getElementById("pass").value;
			const gallery = document.getElementById("gallery");

            fetch("https://cpp-b.onrender.com/login", {
                method: "POST",
                headers: {
                      "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    log: log,
                    pass: pass
                })
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById("result").innerText = data.komunikat;
				if (!data.komunikat.startsWith("Nieprawidłowy")) {
        			localStorage.setItem("password", pass);
     				localStorage.setItem("login", log);
				if(data.admin){
				document.getElementById("admin_panel").style.display = "block";
				}
				gallery.innerHTML = "";
				const linki = data.linki || [];
				linki.forEach(url => { 
					const img = document.createElement("img");
        			img.src = url;
					gallery.appendChild(img);
				 })
	document.getElementById("log").value="";
	document.getElementById("pass").value="";
        })
	};


	function zarejestruj() {
            const log = document.getElementById("log").value;
            const pass = document.getElementById("pass").value;

            fetch("https://cpp-b.onrender.com/zarejestruj", {
                method: "POST",
                headers: {
                      "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    log: log,
                    pass: pass
                })
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById("result").innerText =
                   data.komunikat;
            })
	document.getElementById("log").value="";
	document.getElementById("pass").value="";
        };


	function admin_add() {

		const log = document.getElementById("admin_login").value;
            const url = document.getElementById("admin_url").value;

            fetch("https://cpp-b.onrender.com/admin_add", {
                method: "POST",
                headers: {
                      "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    log: log,
                    url: url
                })
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById("result").innerText =
                   data.komunikat;
            })


	}


    </script>
</body>
</html>
